<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Base64 File Transfer</title>

<style>
body {
    font-family: Arial, sans-serif;
    margin: 40px;
}

button {
    padding: 8px 14px;
    margin-left: 6px;
}

#fileList a {
    display: block;
    margin: 4px 0;
}
</style>
</head>

<body>

<h2>Upload File (Text Only)</h2>

<input type="file" id="fileInput">
<button onclick="upload()">Upload</button>

<h3>Stored Files</h3>
<div id="fileList">Loading...</div>

<script>
const API = "/api";

/* Load file list on page start */
function listFiles() {
    fetch(API + "/files")
        .then(r => r.json())
        .then(files => {
            const container = document.getElementById("fileList");
            container.innerHTML = "";

            if (files.length === 0) {
                container.textContent = "No files stored.";
                return;
            }

            files.forEach(name => {
                const link = document.createElement("a");
                link.href = API + "/download/" + name;
                link.textContent = name;
                container.appendChild(link);
            });
        });
}


/* Upload: file → Base64 text → API */
function upload() {
    const fileInput = document.getElementById("fileInput");
    const file = fileInput.files[0];

    if (!file) {
        alert("Choose a file first");
        return;
    }

    if (file.size > 30 * 1024 * 1024) {
        alert("Max allowed size is 30MB");
        return;
    }

    const reader = new FileReader();

    reader.onload = function () {
        /* result looks like:
           data:application/octet-stream;base64,XXXXX
           so we extract only the text */
        const base64Text = reader.result.split(',')[1];

        fetch(API + "/upload", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                filename: file.name,
                data: base64Text
            })
        })
        .then(r => r.json())
        .then(() => {
            alert("Upload complete");
            listFiles();
        });
    };

    /* Browser converts file locally */
    reader.readAsDataURL(file);
}

/* initial load */
listFiles();
</script>

</body>
</html>
