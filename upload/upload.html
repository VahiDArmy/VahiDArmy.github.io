<!DOCTYPE html>
<html>
<head>
    <title>Base64 Binary API</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>

<div class="container">
    <h1>File Converter</h1>

    <input type="file" id="fileInput">
    <input type="text" id="filename" placeholder="Output filename">

    <button onclick="convertAndUpload()">Convert & Download</button>

    <button onclick="loadFiles()">Fetch Previous Files</button>

    <p id="status"></p>

    <h3>Stored Files</h3>
    <ul id="fileList"></ul>
</div>

<script>
async function convertAndUpload() {
    const fileInput = document.getElementById("fileInput");
    const filenameInput = document.getElementById("filename");
    const status = document.getElementById("status");

    if (!fileInput.files.length) {
        alert("Select file first");
        return;
    }

    const file = fileInput.files[0];
    const filename = filenameInput.value || file.name;

    status.innerText = "Reading file...";

    const reader = new FileReader();

    reader.onload = async function () {
        const base64Text = reader.result.split(",")[1];

        status.innerText = "Sending to API...";

        const response = await fetch("vahid8910.pythonanywhere.com//api/base64-to-binary", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({
                data: base64Text,
                filename: filename
            })
        });

        const blob = await response.blob();

        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = filename;
        a.click();

        URL.revokeObjectURL(url);

        status.innerText = "Done.";
        loadFiles();
    };

    reader.readAsDataURL(file);
}


async function loadFiles() {
    const list = document.getElementById("fileList");
    list.innerHTML = "";

    const res = await fetch("/api/files");
    const files = await res.json();

    files.forEach(f => {
        const li = document.createElement("li");
        const link = document.createElement("a");

        link.href = "/api/download/" + f;
        link.innerText = f;

        li.appendChild(link);
        list.appendChild(li);
    });
}
</script>

</body>
</html>
