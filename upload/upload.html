<!DOCTYPE html>
<html>
<head>
    <title>Base64 Binary Manager</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>

<div class="container">
    <h1>File Manager</h1>

    <input type="file" id="fileInput">
    <input type="text" id="filename" placeholder="Output filename">

    <button onclick="convertAndUpload()">Convert & Save</button>

    <button onclick="loadFiles()">Refresh File List</button>

    <p id="status"></p>

    <h3>Stored Files</h3>
    <ul id="fileList"></ul>
</div>

<script>
async function convertAndUpload() {
    const fileInput = document.getElementById("fileInput");
    const filenameInput = document.getElementById("filename");
    const status = document.getElementById("status");

    if (!fileInput.files.length) {
        alert("Select a file first.");
        return;
    }

    const file = fileInput.files[0];
    const filename = filenameInput.value || file.name;

    status.innerText = "Reading file...";

    const reader = new FileReader();

    reader.onload = async function () {
        const base64Text = reader.result.split(",")[1];

        status.innerText = "Uploading to API...";

        const response = await fetch("/api/base64-to-binary", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({
                data: base64Text,
                filename: filename
            })
        });

        const result = await response.json();

        status.innerText = result.message || "Done.";

        loadFiles();
    };

    reader.readAsDataURL(file);
}


async function loadFiles() {
    const list = document.getElementById("fileList");
    list.innerHTML = "";

    const res = await fetch("/api/files");
    const files = await res.json();

    files.forEach(f => {
        const li = document.createElement("li");

        const nameSpan = document.createElement("span");
        nameSpan.innerText = f + " ";

        const downloadBtn = document.createElement("button");
        downloadBtn.innerText = "Download";
        downloadBtn.onclick = () => {
            window.location.href = "/api/download/" + f;
        };

        const deleteBtn = document.createElement("button");
        deleteBtn.innerText = "Delete";
        deleteBtn.onclick = async () => {
            await fetch("/api/delete/" + f, {method: "DELETE"});
            loadFiles();
        };

        li.appendChild(nameSpan);
        li.appendChild(downloadBtn);
        li.appendChild(deleteBtn);
        list.appendChild(li);
    });
}

// Load file list on page load
loadFiles();
</script>

</body>
</html>
