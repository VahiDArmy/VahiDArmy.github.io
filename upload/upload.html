
<!DOCTYPE html>
<html>
<head>
    <title>Base64 Binary API Demo</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>

<div class="container">
    <h1>✨ File → Base64 → Binary</h1>
    <p class="subtitle">
        File stays local. Only text goes to server.
    </p>

    <input type="file" id="fileInput">
    <input type="text" id="filename" placeholder="Output filename">

    <button onclick="convertAndUpload()">
        Convert & Download
    </button>

    <p id="status"></p>

    <footer>Browser handles encoding • API handles decoding</footer>
</div>

<script>
async function convertAndUpload() {
    const fileInput = document.getElementById("fileInput");
    const filenameInput = document.getElementById("filename");
    const status = document.getElementById("status");

    if (!fileInput.files.length) {
        alert("Choose a file first.");
        return;
    }

    const file = fileInput.files[0];
    const filename = filenameInput.value || file.name;

    status.innerText = "Reading local file...";

    const reader = new FileReader();

    reader.onload = async function () {
        status.innerText = "Encoding to Base64...";

        const base64Text = reader.result.split(",")[1];

        status.innerText = "Sending text to API...";

        const response = await fetch("https://vahidarmy.github.io/upload/upload/api/base64-to-binary", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({
                data: base64Text,
                filename: filename
            })
        });

        if (!response.ok) {
            status.innerText = "Server error.";
            return;
        }

        status.innerText = "Downloading result...";

        const blob = await response.blob();

        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = filename;
        a.click();

        URL.revokeObjectURL(url);

        status.innerText = "Done.";
    };

    reader.readAsDataURL(file);
}
</script>

</body>
</html>
